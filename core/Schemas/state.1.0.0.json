{
  "key": "state",
  "version": "1.0.0",
  "domain": "core",
  "flow": "sys-schemas",
  "flowVersion": "1.0.0",
  "tags": [
    "Core",
    "State",
    "Workflow",
    "StateMachine"
  ],
  "attributes": {
    "type": "state",
    "schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "https://schemas.amorphie.com/core/state.json",
      "title": "State Definition",
      "description": "Amorphie workflow state machine içindeki bir state'in tanımı. State'ler workflow'un temel yapı taşlarıdır.",
      "type": "object",
      "properties": {
        "key": {
          "type": "string",
          "description": "State'in anahtar değeri. Workflow içinde benzersiz olmalıdır.",
          "pattern": "^[a-zA-Z0-9\\-]+$",
          "maxLength": 255
        },
        "stateType": {
          "type": "integer",
          "enum": [
            1,
            2,
            3,
            4
          ],
          "description": "State'in türü. 1=Initial, 2=Intermediate, 3=Final, 4=SubFlow"
        },
        "stateSubType": {
          "type": "integer",
          "enum": [
            1,
            2,
            3
          ],
          "description": "Final state'ler için alt tür. 1=Success, 2=Failed, 3=Cancelled"
        },
        "versionStrategy": {
          "type": "string",
          "enum": [
            "Minor",
            "Major"
          ],
          "description": "State'in versiyon yönetim stratejisi",
          "maxLength": 50
        },
        "labels": {
          "$ref": "Label.1.0.0.json#/attributes",
          "description": "State'in çoklu dil etiketleri"
        },
        "view": {
          "anyOf": [
            {
              "$ref": "Reference.1.0.0.json#/attributes"
            },
            {
              "type": "null"
            }
          ],
          "description": "State ile ilişkili view referansı"
        },
        "subFlow": {
          "anyOf": [
            {
              "type": "object",
              "required": [
                "type",
                "process"
              ],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "C",
                    "F",
                    "S",
                    "P"
                  ],
                  "description": "SubFlow türü. C=Core, F=Flow, S=SubFlow, P=SubProcess",
                  "maxLength": 10
                },
                "process": {
                  "$ref": "Reference.1.0.0.json#/attributes",
                  "description": "SubFlow process referansı"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "null"
            }
          ],
          "description": "SubFlow state türü için çağrılacak alt workflow'un bilgisi"
        },
        "transitions": {
          "type": "array",
          "items": {
            "$ref": "Transition.1.0.0.json#/attributes"
          },
          "description": "Bu state'den çıkış yapılabilecek geçişlerin listesi"
        },
        "views": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "viewType",
              "viewTarget"
            ],
            "properties": {
              "viewType": {
                "type": "integer",
                "enum": [
                  1,
                  2,
                  3
                ],
                "description": "View türü. 1=JSON, 2=HTML, 3=Markdown"
              },
              "viewTarget": {
                "type": "integer",
                "enum": [
                  1,
                  2,
                  3
                ],
                "description": "View hedefi. 1=State, 2=Transition, 3=Task"
              },
              "content": {
                "type": "string",
                "description": "View içeriği"
              },
              "key": {
                "type": "string",
                "description": "View key"
              },
              "domain": {
                "type": "string",
                "description": "View domain"
              },
              "workflow": {
                "type": "string",
                "description": "View workflow"
              },
              "version": {
                "type": "string",
                "description": "View version"
              }
            }
          },
          "description": "Bu state ile ilişkili kullanıcı arayüzü view'ları."
        },
        "onEntries": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "order",
              "task",
              "mapping"
            ],
            "properties": {
              "order": {
                "type": "integer",
                "minimum": 1,
                "description": "Görevin çalışma sırası"
              },
              "task": {
                "$ref": "Reference.1.0.0.json#/attributes",
                "description": "Çalıştırılacak task referansı"
              },
              "mapping": {
                "type": "object",
                "required": [
                  "code",
                  "location"
                ],
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "Mapping kodu"
                  },
                  "location": {
                    "type": "string",
                    "description": "Kod dosyasının konumu"
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          },
          "description": "State'e girildiğinde çalıştırılacak görevler"
        },
        "onExits": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "order",
              "task",
              "mapping"
            ],
            "properties": {
              "order": {
                "type": "integer",
                "minimum": 1,
                "description": "Görevin çalışma sırası"
              },
              "task": {
                "$ref": "Reference.1.0.0.json#/attributes",
                "description": "Çalıştırılacak task referansı"
              },
              "mapping": {
                "type": "object",
                "required": [
                  "code",
                  "location"
                ],
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "Mapping kodu"
                  },
                  "location": {
                    "type": "string",
                    "description": "Kod dosyasının konumu"
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          },
          "description": "State'den çıkılırken çalıştırılacak görevler"
        },
        "onExecutionTasks": {
          "type": "array",
          "description": "State execution sırasında çalıştırılacak görevler dizisi",
          "items": {
            "type": "object",
            "properties": {
              "order": {
                "type": "integer",
                "description": "Görevin çalışma sırası. Aynı sıradaki görevler paralel çalıştırılır.",
                "minimum": 1
              },
              "task": {
                "type": "object",
                "required": [
                  "key",
                  "domain",
                  "flow",
                  "version"
                ],
                "properties": {
                  "key": {
                    "type": "string",
                    "description": "Task key"
                  },
                  "domain": {
                    "type": "string",
                    "description": "Domain name"
                  },
                  "flow": {
                    "type": "string",
                    "description": "Flow name for tasks",
                    "const": "sys-tasks"
                  },
                  "version": {
                    "type": "string",
                    "description": "Version in Major.Minor.Patch format",
                    "pattern": "^\\d+\\.\\d+\\.\\d+$"
                  }
                }
              },
              "mapping": {
                "$ref": "Mapping.1.0.0.json#/attributes",
                "description": "Göreve iletilecek ve geri dönüşümde alınacak verilerin mapping tanımı"
              }
            },
            "required": [
              "order",
              "task"
            ],
            "additionalProperties": false
          }
        }
      },
      "required": [
        "key",
        "stateType",
        "versionStrategy",
        "labels"
      ],
      "additionalProperties": false
    }
  }
}
